webpackJsonp([1],[,,,,,,,,,,,,,,function(t,e,n){"use strict";n.d(e,"e",function(){return u}),n.d(e,"g",function(){return l}),n.d(e,"c",function(){return f}),n.d(e,"d",function(){return v}),n.d(e,"h",function(){return d});var a=n(56),i=n.n(a),r=(n(111),n(115),n(118)),s=(n.n(r),n(119)),o=n.n(s);n.d(e,"f",function(){return i.a}),n.d(e,"a",function(){return o.a}),n.o(r,"GeoFirestore")&&n.d(e,"b",function(){return r.GeoFirestore}),i.a.initializeApp({apiKey:"AIzaSyDgPNnncRq9d3KylyRDUdZqzIf-aCh0694",authDomain:"locary-0.firebaseapp.com",databaseURL:"https://locary-0.firebaseio.com",projectId:"locary-0",storageBucket:"locary-0.appspot.com",messagingSenderId:"1062407146615"});var c=i.a.firestore(),u=i.a.database();c.settings({timestampsInSnapshots:!0});var l=new r.GeoFirestore(c.collection("locaries")),d=c.collection("users"),f=i.a.firestore.GeoPoint,v=i.a.firestore.Timestamp},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e){},,,,,,function(t,e,n){"use strict";var a=n(101),i=n(106),r=n(14),s=n(122),o=n.n(s);n(59);e.a={components:{map1:a.a,threads:i.a},created:function(){var t=this.$store;r.f.auth().onAuthStateChanged(function(e){e?t.dispatch("getUserRef",{authUser:e}):r.f.auth().setPersistence(r.f.auth.Auth.Persistence.LOCAL).then(function(){var t=new o.a.auth.AuthUI(r.f.auth()),e={callbacks:{signInSuccessWithAuthResult:function(e,n){return t.delete(),!1}},signInOptions:[r.f.auth.GoogleAuthProvider.PROVIDER_ID],signInFlow:"popup"};t.start("#firebaseui-auth-container",e)})})},data:function(){return{clipped:!1,drawer:!1,fixed:!1,miniVariant:!1,right:!0,title:"Locary",dialog:!1}},computed:{rightDrawer:{get:function(){return this.$store.getters.rightDrawer},set:function(t){this.$store.commit("setRightDrawer",t)}},threadMessage:function(){return this.$store.getters.threadMessage},userRef:function(){return this.$store.getters.userRef}},methods:{logout:function(){this.$store.commit("setUserRef",null),r.f.auth().signOut(),this.dialog=!1},signIn:function(){document.querySelector(".firebaseui-idp-google").click()}},name:"App"}},function(t,e,n){"use strict";e.a={data:function(){return{items:[{icon:"map",title:"My Scope Range"}],mapOption:{disableDefaultUI:!0,gestureHandling:"none",zoomControl:!1}}},computed:{center:function(){var t=this.$store.getters.position;return t?{lat:t.latitude,lng:t.longitude}:null},height:function(){return this.$refs.mapRef.clientHeight},radius:function(){return 1e3*this.$store.getters.listeningRadius},listeningRadius:function(){return this.$store.getters.listeningRadius},zoom:function(){for(var t=this.$store.getters.listeningRadius,e=0;e<=14;e++)if(1<<e<=t&&1<<e+1>t)return 14-e},listeningUserCount:function(){return this.$store.getters.listeningUserCount}}}},function(t,e,n){"use strict";var a=n(14),i=n(120),r=n.n(i);e.a={props:["threadMessage"],data:function(){return{content:"",threads:[],unsubscribe:null}},created:function(){this.threadOperation()},watch:{threadMessage:function(){this.unsubscribe(),this.threadOperation()}},computed:{userRef:function(){return this.$store.getters.userRef}},methods:{sendThreads:function(){var t=this;if(""===this.content.trim())return!1;var e=this.$store,n=this.$store.getters.position,i={userRef:e.getters.userRef,displayName:e.getters.userInfo.displayName,coordinates:new a.c(n.latitude,n.longitude),body:this.content,createdAt:new Date,photoURL:e.getters.userInfo.photoURL,accuracy:n.accuracy},r=this.threadMessage,s=r.threadCount,o=r.key;a.g.ref().doc(o).update({"d.threadCount":s>0?++s:Number(1)}),a.g.ref().doc(o).collection("threads").add(i).then(function(){t.content="",t.scrollToBottom()})},scrollToBottom:function(){var t=this;this.$nextTick(function(){var e=t.$refs.container;e.scrollTop=e.scrollHeight,console.log(".container.scrollHeight: "+e.scrollHeight)})},threadOperation:function(){var t=this;this.threads=[],this.unsubscribe=a.g.ref().doc(this.threadMessage.key).collection("threads").orderBy("createdAt").onSnapshot(function(e){e.docChanges().forEach(function(e){if("added"===e.type&&t.threads.push(e.doc.data()),"modified"===e.type){var n=e.doc.id,a=t.threads.indexOf(function(t){return t.id===n});t.threads.splice(a,1,e.doc.data())}if("removed"===e.type){var i=e.doc.id,r=t.threads.indexOf(function(t){return t.id===i});t.threads.splice(r,1)}})})},signIn:function(){document.querySelector(".firebaseui-idp-google").click()},imgUrlAlt:function(t){console.log(r.a),t.target.src=r.a},distance:function(t){var e=this.$store.getters.position,n=new a.c(e.latitude,e.longitude),i=a.b.distance(n,t);return i>=1?Math.floor(i)+"km":Math.floor(1e3*i)+"m"}}}},,,,,,function(t,e,n){"use strict";var a=n(130),i=n.n(a),r=n(33),s=n.n(r),o=n(141),c=n(144),u=n(14),l=n(148),d=n.n(l);e.a={data:function(){return{dialog:!1,content:"",empty:!0,locaries:[],totalChatHeight:0,geoQuery:null,queryLimit:5,alert:!1,alertMessage:"this is alert",maxlength:300}},components:{message:o.a,firebaseui:c.a},mounted:function(){var t=this;this.$store.commit("setLoading",!0);var e=this.$store,n=this.authUser,a=n?n.uid:d()();console.time("getCurrentPosition"),navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(n){console.timeEnd("getCurrentPosition",n),e.commit("setPosition",n.coords),e.dispatch("rtdb_presence",{uid:a}),e.dispatch("getListeningRadius").then(t.loadChat)})},computed:{userRef:function(){return this.$store.getters.userRef},displayName:function(){return this.$store.getters.userInfo.displayName},radius:function(){return this.$store.getters.listeningRadius},loading:function(){return this.$store.getters.loading}},methods:{loadChat:function(){var t=this,e=this.$store.getters.position,n=this.radius,a=new u.c(e.latitude,e.longitude),i=u.g.query({center:a,radius:n});this.geoQuery=i,i.on("ready",function(){t.locaries.sort(function(t,e){return t.createdAt.toMillis()>=e.createdAt.toMillis()?1:-1}),t.loading&&t.scrollToBottom()}),i.on("key_entered",function(e,n,a){n.userRef===t.userRef&&(n.isRead=!0),s()(n,{key:e,distance:a}),t.locaries.push(n)}),i.on("key_modified",function(e,n,a){var i=t.locaries.findIndex(function(t){return t.key===e});s()(t.locaries[i],n)}),i.on("key_exited",function(e,n,a){var i=t.locaries.findIndex(function(t){return t.key===e});t.locaries.splice(i,1)}),this.watchLocation()},updateLocaries:function(){var t=this.$store.getters.position,e=this.radius,n=new u.c(t.latitude,t.longitude);this.geoQuery.updateCriteria({center:n,radius:e})},watchLocation:function(){var t=this,e=this,n=this.$store;navigator.geolocation&&navigator.geolocation.watchPosition(function(a){var r=t.$store.getters.position,s=a.coords;i()(r)!==i()(s)&&(n.commit("setPosition",a.coords),n.dispatch("updateLocation"),e.updateLocaries())})},sendMessage:function(){var t=this;if(""===this.content.trim())return!1;var e=this.$store,n=this.$store.getters.position,a={userRef:e.getters.userRef,displayName:e.getters.userInfo.displayName,photoURL:e.getters.userInfo.photoURL,coordinates:new u.c(n.latitude,n.longitude),body:this.content,createdAt:u.d.fromDate(new Date),accuracy:n.accuracy,readCount:0,clickCount:0,threadCount:0};u.g.add(a).then(function(e){console.log(e),t.content="",t.scrollToBottom()})},onScroll:function(t){var e=this,n=this;if(t.target.scrollTop<1&&!this.empty){n.$store.commit("setLoading",!0),this.queryLimit+=5;var a=function(t){return t.limit(e.queryLimit)};this.geoQuery.updateCriteria({query:a}),this.geoQuery.on("ready",function(){n.locaries.sort(function(t,e){return t.createdAt.toMillis()>e.createdAt.toMillis()}),n.$store.commit("setLoading",!1),n.scrollTo()})}},scrollTo:function(){var t=this;this.$nextTick(function(){var e=t.$refs.chatContainer.scrollHeight,n=e-t.totalChatHeight;t.$el.querySelector(".chat-container").scrollTop=n,t.totalChatHeight=e})},scrollToBottom:function(){var t=this;this.$nextTick(function(){var e=t.$refs.chatContainer;e.scrollTop=e.scrollHeight,console.log(".chat-container.scrollHeight: "+e.scrollHeight),t.totalChatHeight=e.scrollHeight,t.$store.commit("setLoading",!1)})},triggerAlertMessage:function(t){var e=this;this.alertMessage=t,this.alert=!0,setTimeout(function(){e.alert=!1},1e3)}},destroyed:function(){},watch:{radius:function(){null!==this.geoQuery&&this.updateLocaries()},content:function(t){var e=this.maxlength;t.length>=e&&this.triggerAlertMessage("cannot exceed "+e+" charactors")}}}},,,,,,,,function(t,e,n){"use strict";var a=n(14);e.a={data:function(){return{}},props:["messages"],components:{},computed:{userRef:function(){return this.$store.getters.userRef||{}},loading:function(){return this.$store.getters.loading}},methods:{timestamp:function(t){return new a.d(t)},visibilityChanged:function(t,e){if(t&&!e.isRead){var n=e.readCount,i=e.key;e.readCount++,e.isRead=!0,a.g.ref().doc(i).update({"d.readCount":n>0?++n:Number(1)})}},openThreads:function(t){var e=t.clickCount,n=t.key;a.g.ref().doc(n).update({"d.clickCount":e>0?++e:Number(1)}),this.$store.commit("setThreadsMessage",t),this.$store.commit("setRightDrawer",!0)}}}},function(t,e,n){"use strict";e.a={}},,,,,,,,,,,,,,,,,,,,,function(t,e,n){"use strict";e.a=function(t){return t.default||t}(n(314))},function(t,e,n){"use strict";e.a=function(t){return t.default||t}(n(318))},,function(t,e,n){"use strict";e.a=function(t){return t.default||t}(n(322))},,,function(t,e,n){"use strict";e.a=function(t){return t.default||t}(n(327))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n(0),i=n(100),r=n(126),s=n(152),o=n(154),c=n(194),u=n(195),l=n.n(u),d=n(205),f=n.n(d),v=n(213),g=n.n(v),h=n(220),p=n.n(h),m=n(229),_=n.n(m),y=n(234),C=n.n(y),x=n(237),b=n.n(x),R=n(86),w=n.n(R),M=n(19),k=n.n(M),D=n(254),L=n.n(D),T=n(260),A=n.n(T),I=n(265),$=n.n(I),P=n(268),S=n.n(P),U=n(289),N=n.n(U),H=n(46),E=n.n(H),V=n(290),j=n.n(V),O=n(293),F=n.n(O),z=n(300),q=n.n(z),B=n(303),Q=(n.n(B),n(304)),G=n(305);n.n(G);a.default.use(G,{load:{key:"AIzaSyCgYdhYLkKleeZbS8PrknHCzEe453hscg4",libraries:"places"}}),a.default.use(Q.a),a.default.use(c.a),a.default.use(l.a,{components:{VApp:f.a,VAlert:g.a,VCard:p.a,VNavigationDrawer:_.a,VFooter:C.a,VList:b.a,VBtn:w.a,VIcon:k.a,VGrid:L.a,VToolbar:A.a,VSubheader:$.a,VTextarea:S.a,VImg:N.a,transitions:E.a,VTextField:j.a,VDialog:F.a,VDivider:q.a}}),a.default.use(s.a),a.default.config.productionTip=!1,new a.default({el:"#app",router:r.a,store:o.a,components:{App:i.a},template:"<App/>"})},,function(t,e,n){"use strict";var a=n(53),i=n(125),r=n(7),s=r(a.a,i.a,!1,null,null,null);e.a=s.exports},function(t,e,n){"use strict";function a(t){n(102)}var i=n(54),r=n(104),s=n(7),o=a,c=s(i.a,r.a,!1,o,"data-v-0a502364",null);e.a=c.exports},function(t,e){},,function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-layout",{attrs:{"fill-height":"",column:""}},[a("v-list",t._l(t.items,function(e,n){return a("v-list-tile",{key:n,attrs:{value:"true"}},[a("v-list-tile-action",[a("v-icon",{domProps:{innerHTML:t._s(e.icon)}})],1),t._v(" "),a("v-list-tile-content",[a("v-list-tile-title",{domProps:{textContent:t._s(e.title)}})],1)],1)})),t._v(" "),a("v-flex",{ref:"mapRef"},[0===t.listeningUserCount?a("img",{staticClass:"globe",attrs:{src:n(105)}}):t.center?a("div",[a("gmap-map",{style:"width:100%;  height: "+t.height+"px;",attrs:{center:t.center,zoom:t.zoom,options:t.mapOption}},[a("gmap-circle",{attrs:{center:t.center,radius:t.radius}})],1)],1):t._e(),t._v(" "),a("div",{staticClass:"tip"},[a("div",[t._v("You can listen to "+t._s(t.listeningUserCount)+" user"+t._s(t.listeningUserCount>1?"s":"")+" near you.")]),t._v(" "),0===t.listeningUserCount?a("div",[t._v("Hence you have access to locaries from the whole globe!")]):a("div",[a("span",[t._v("The furthest user is within "+t._s(t.listeningRadius)+" km,")]),t._v(" "),a("span",[t._v("Hence you have access to locaries within this distance")])])])])],1)},i=[],r={render:a,staticRenderFns:i};e.a=r},function(t,e,n){t.exports=n.p+"static/img/globe.4c7bf38.jpg"},function(t,e,n){"use strict";function a(t){n(107)}var i=n(55),r=n(121),s=n(7),o=a,c=s(i.a,r.a,!1,o,"data-v-a232054a",null);e.a=c.exports},function(t,e){},,,,,,,,,,,,,function(t,e){t.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMTIgMTJjMi4yMSAwIDQtMS43OSA0LTRzLTEuNzktNC00LTQtNCAxLjc5LTQgNCAxLjc5IDQgNCA0em0wIDJjLTIuNjcgMC04IDEuMzQtOCA0djJoMTZ2LTJjMC0yLjY2LTUuMzMtNC04LTR6Ii8+PHBhdGggZD0iTTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIvPjwvc3ZnPg=="},function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.threadMessage?n("v-layout",{attrs:{"fill-height":"",column:""}},[n("v-flex",{ref:"container",staticStyle:{"flex-grow":"100","max-height":"calc(100vh - 5.2rem)","overflow-y":"auto"}},[n("v-layout",{staticClass:"message",attrs:{column:""}},[n("v-flex",[n("v-layout",[n("v-flex",{staticClass:"photo mr-1",staticStyle:{flex:"0 1 auto"}},[n("img",{attrs:{src:t.threadMessage.photoURL,alt:"photo"},on:{error:t.imgUrlAlt}})]),t._v(" "),n("v-flex",{staticClass:"mx-1"},[n("v-layout",{attrs:{column:""}},[n("v-flex",{staticClass:"name"},[n("v-icon",{attrs:{small:""}},[t._v("person")]),t._v("\n                "+t._s(t.threadMessage.displayName)+"\n              ")],1),t._v(" "),n("v-flex",[n("v-icon",{attrs:{small:""}},[t._v("access_time")]),t._v("\n                "+t._s(t.threadMessage.createdAt.toDate().toDateString())+"\n              ")],1)],1)],1),t._v(" "),n("v-flex",{staticClass:"mx-1"},[n("v-layout",{staticClass:"text-left",attrs:{column:""}},[n("v-flex",[n("v-icon",{attrs:{small:""}},[t._v("mouse")]),t._v("\n                "+t._s(t.threadMessage.clickCount)+"\n              ")],1),t._v(" "),n("v-flex",[n("v-icon",{attrs:{small:""}},[t._v("spellcheck")]),t._v("\n                "+t._s(t.threadMessage.readCount)+"\n              ")],1)],1)],1),t._v(" "),n("v-flex",{staticClass:"mx-1"},[n("v-layout",{staticClass:"text-left",attrs:{column:""}},[n("v-flex",[n("v-icon",{attrs:{small:""}},[t._v("near_me")]),t._v("\n                "+t._s(t.threadMessage.distance>=1?Math.floor(t.threadMessage.distance)+"km":Math.floor(1e3*t.threadMessage.distance)+"m")+"\n              ")],1)],1)],1)],1)],1),t._v(" "),n("v-flex",{staticClass:"body",domProps:{innerHTML:t._s(t.threadMessage.body)}})],1),t._v(" "),t._l(t.threads,function(e,a){return n("v-flex",{key:a,staticClass:"threads",class:{own:t.userRef&&e.userRef.id==t.userRef.id}},[0===a||e[a-1]&&e.createdAt.toDate().toDateString()!==e[a-1].createdAt.toDate().toDateString()?n("v-flex",{staticClass:"date"},[t._v(t._s(e.createdAt.toDate().toDateString()))]):t._e(),t._v(" "),t.threads[a-1]&&function(t,e){return t.getTime()-e.getTime()>6e4}(e.createdAt.toDate(),t.threads[a-1].createdAt.toDate())?n("div",{staticClass:"mt-2"}):t._e(),t._v(" "),0==a||a>0&&t.threads[a-1].userRef.id!=e.userRef.id?n("div",{staticClass:"displayName"},[t._v(t._s(e.displayName))]):t._e(),t._v(" "),n("v-layout",{attrs:{"align-end":""}},[n("v-flex",{staticClass:"photo"},[void 0===t.threads[a+1]||t.threads[a-1]&&function(t,e){return t.getTime()-e.getTime()>6e4}(e.createdAt.toDate(),t.threads[a-1].createdAt.toDate())||t.threads[a+1].userRef.id!=e.userRef.id?n("img",{attrs:{src:e.photoURL,alt:"photo"},on:{error:t.imgUrlAlt}}):t._e()]),t._v(" "),n("v-flex",{staticClass:"body",domProps:{innerHTML:t._s(e.body)}}),t._v(" "),n("v-flex",{staticClass:"minor"},[n("v-flex",[n("v-icon",{attrs:{small:""}},[t._v("access_time")]),t._v("\n            "+t._s(function(t){return""+t.toISOString().substring(11,16)}(e.createdAt.toDate()))+"\n          ")],1),t._v(" "),n("v-flex",[n("v-icon",{attrs:{small:""}},[t._v("near_me")]),t._v("\n            "+t._s(t.distance(e.coordinates))+"\n          ")],1)],1)],1)],1)})],2),t._v(" "),n("v-flex",{staticStyle:{"flex-grow":"1"}},[t.userRef?n("v-layout",{staticStyle:{position:"relative"}},[n("div",{staticStyle:{width:"calc(100% - 100px)"}},[n("v-textarea",{staticStyle:{"padding-left":"10px"},attrs:{placeholder:"Type here...","auto-grow":"",rows:"2","hide-details":"","background-color":"transparent",maxlength:"300"},on:{keyup:function(e){return("button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter"))&&e.ctrlKey?t.sendThreads(e):null}},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}})],1),t._v(" "),n("button",{staticClass:"stamp",attrs:{type:"button"},on:{click:t.sendThreads}},[t._v("send")])]):n("v-layout",{staticClass:"mt-3",attrs:{"justify-center":""}},[n("v-btn",{on:{click:t.signIn}},[t._v("Sign in & contribute to locaries")])],1)],1)],1):t._e()},i=[],r={render:a,staticRenderFns:i};e.a=r},,,,function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-app",[n("v-navigation-drawer",{attrs:{persistent:"","mini-variant":t.miniVariant,clipped:t.clipped,"enable-resize-watcher":"",fixed:"",app:""},model:{value:t.drawer,callback:function(e){t.drawer=e},expression:"drawer"}},[n("map1")],1),t._v(" "),n("v-toolbar",{attrs:{app:"","clipped-left":t.clipped}},[n("v-toolbar-side-icon",{on:{click:function(e){e.stopPropagation(),t.drawer=!t.drawer}}}),t._v(" "),n("v-toolbar-title",{domProps:{textContent:t._s(t.title)}}),t._v(" "),n("v-spacer"),t._v(" "),null!==t.userRef?n("v-dialog",{model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[n("v-btn",{attrs:{slot:"activator",dark:"",color:null!==t.userRef?"secondary":"blue-grey"},slot:"activator"},[n("v-icon",{attrs:{dark:""}},[t._v("person_outline")]),t._v(" "),n("span",[t._v(t._s(null===t.userRef?"logged out":"log out"))])],1),t._v(" "),n("v-card",[n("v-card-title",{staticClass:"headline grey lighten-2",attrs:{"primary-title":""}},[t._v("Log out")]),t._v(" "),n("v-card-text",[t._v("Are you sure to log out?")]),t._v(" "),n("v-divider"),t._v(" "),n("v-card-actions",[n("v-spacer"),t._v(" "),n("v-btn",{attrs:{color:"primary",flat:""},on:{click:function(e){t.dialog=!1}}},[t._v("Cancel")]),t._v(" "),n("v-btn",{attrs:{color:"red",flat:""},on:{click:t.logout}},[t._v("Log out")])],1)],1)],1):n("v-btn",{attrs:{dark:"",color:"blue-grey"},on:{click:t.signIn}},[n("v-icon",{attrs:{dark:""}},[t._v("person_outline")]),t._v(" "),n("span",[t._v("Log In")])],1)],1),t._v(" "),n("v-content",[n("router-view")],1),t._v(" "),n("v-navigation-drawer",{attrs:{temporary:"",right:t.right,fixed:"",app:"",width:"320"},model:{value:t.rightDrawer,callback:function(e){t.rightDrawer=e},expression:"rightDrawer"}},[t.threadMessage?n("threads",{attrs:{threadMessage:t.threadMessage}}):t._e()],1)],1)},i=[],r={render:a,staticRenderFns:i};e.a=r},function(t,e,n){"use strict";var a=n(0),i=n(127);a.default.use(i.a),e.a=new i.a({routes:[{path:"/",component:n(128).default}]})},,function(t,e,n){"use strict";function a(t){n(129)}Object.defineProperty(e,"__esModule",{value:!0});var i=n(61),r=n(151),s=n(7),o=a,c=s(i.a,r.a,!1,o,null,null);e.default=c.exports},function(t,e){},,,,,,,,,,,,function(t,e,n){"use strict";function a(t){n(142)}var i=n(69),r=n(143),s=n(7),o=a,c=s(i.a,r.a,!1,o,"data-v-019325aa",null);e.a=c.exports},function(t,e){},function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("transition-group",{attrs:{name:"list"}},t._l(t.messages,function(e,a){return n("div",{key:a,staticClass:"message",class:{own:e.userRef.id==t.userRef.id}},[0===a||e.createdAt.toDate().toDateString()!==t.messages[a-1].createdAt.toDate().toDateString()?n("v-flex",{staticClass:"date"},[t._v(t._s(e.createdAt.toDate().toDateString()))]):t._e(),t._v(" "),t.messages[a-1]&&function(t,e){return t.getTime()-e.getTime()>6e4}(e.createdAt.toDate(),t.messages[a-1].createdAt.toDate())?n("div",{staticClass:"mt-2"}):t._e(),t._v(" "),0==a||a>0&&t.messages[a-1].userRef.id!=e.userRef.id?n("div",{staticClass:"user"},[t._v(t._s(e.displayName))]):t._e(),t._v(" "),n("v-layout",{attrs:{"align-end":""},on:{click:function(n){t.openThreads(e)}}},[n("v-flex",{staticClass:"photo"},[void 0===t.messages[a+1]||t.messages[a-1]&&function(t,e){return t.getTime()-e.getTime()>6e4}(e.createdAt.toDate(),t.messages[a-1].createdAt.toDate())||t.messages[a+1].userRef.id!=e.userRef.id?n("img",{attrs:{src:e.photoURL,alt:"photo"}}):t._e()]),t._v(" "),n("v-flex",{staticClass:"content"},[n("div",{domProps:{innerHTML:t._s(e.body.length<120?e.body:e.body.slice(0,120)+" ......")}})]),t._v(" "),t.loading?t._e():n("v-flex",{directives:[{name:"observe-visibility",rawName:"v-observe-visibility",value:{callback:function(n){return t.visibilityChanged(n,e)},throttle:300},expression:"{\n          callback: (isVisible) => visibilityChanged(isVisible, message),\n          throttle: 300\n        }"}],staticClass:"minor"},[e.threadCount>0?n("v-flex",{staticClass:"threadCount"},[n("v-icon",{attrs:{small:""}},[t._v("list")]),t._v("\n          "+t._s(e.threadCount)+"\n        ")],1):t._e(),t._v(" "),n("v-flex",{staticClass:"distance"},[n("v-icon",{attrs:{small:""}},[t._v("near_me")]),t._v("\n          "+t._s(e.distance>=1?Math.floor(e.distance)+"km":Math.floor(1e3*e.distance)+"m")+"\n        ")],1)],1)],1)],1)}))},i=[],r={render:a,staticRenderFns:i};e.a=r},function(t,e,n){"use strict";function a(t){n(145),n(146)}var i=n(70),r=n(147),s=n(7),o=a,c=s(i.a,r.a,!1,o,"data-v-6f5e51de",null);e.a=c.exports},function(t,e){},function(t,e){},function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},i=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"loginui"},[n("div",{attrs:{id:"firebaseui-auth-container"}})])}],r={render:a,staticRenderFns:i};e.a=r},,,,function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-layout",{attrs:{column:"","fill-height":""}},[n("v-alert",{staticStyle:{position:"fixed",width:"100%"},attrs:{type:"info",transition:"fade-transition"},model:{value:t.alert,callback:function(e){t.alert=e},expression:"alert"}},[t._v("\n    "+t._s(t.alertMessage)+"\n  ")]),t._v(" "),n("v-flex",{ref:"chatContainer",staticClass:"chat-container",staticStyle:{"flex-grow":"100"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.empty,expression:"empty"}]},[t._v("no more data to fetch.")]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.loading,expression:"loading"}]},[t._v("loading...")]),t._v(" "),n("message",{attrs:{messages:t.locaries}})],1),t._v(" "),n("v-flex",{staticStyle:{"flex-grow":"1"}},[null===t.userRef?n("div",{staticClass:"text-xs-center"},[n("firebaseui")],1):n("v-layout",{staticStyle:{position:"relative"}},[n("div",{staticStyle:{width:"calc(100% - 100px)"}},[n("v-textarea",{staticStyle:{"padding-left":"10px"},attrs:{placeholder:"Type here...","auto-grow":"",rows:"2","hide-details":"","background-color":"transparent",maxlength:t.maxlength},on:{keyup:function(e){return("button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter"))&&e.ctrlKey?t.sendMessage(e):null}},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}})],1),t._v(" "),n("button",{staticClass:"stamp",attrs:{type:"button"},on:{click:t.sendMessage}},[t._v("stamp")])])],1)],1)},i=[],r={render:a,staticRenderFns:i};e.a=r},,function(t,e){},function(t,e,n){"use strict";var a=n(0),i=n(155),r=n(14),s=n(156);a.default.use(i.a),e.a=new i.a.Store({modules:{realtimeDatabase:s.a},state:{loading:!1,error:null,locaries:[],userRef:null,userInfo:null,threadMessage:null,rightDrawer:!1},getters:{loading:function(t){return t.loading},error:function(t){return t.error},locaries:function(t){return t.locaries},userRef:function(t){return t.userRef},rightDrawer:function(t){return t.rightDrawer},threadMessage:function(t){return t.threadMessage},userInfo:function(t){return t.userInfo}},mutations:{setLoading:function(t,e){return t.loading=e},setError:function(t,e){return t.error=e},clearError:function(t){return t.error=null},setLocaries:function(t,e){return t.locaries=e},setUserRef:function(t,e){return t.userRef=e},setUserInfo:function(t,e){return t.userInfo=e},setRightDrawer:function(t,e){return t.rightDrawer=e},setThreadsMessage:function(t,e){return t.threadMessage=e}},actions:{clearError:function(t){(0,t.commit)("clearError")},getUserRef:function(t,e){var n=t.commit,a=t.state,i=e.authUser,s=i.email,o=i.uid,c=r.h.doc(o),u=new Date,l=null,d=null;c.collection("userLog").add({loggedAt:u}),n("setUserRef",c),c.get().then(function(t){if(t.exists)l=t.get("displayName"),d=t.get("photoURL"),n("setUserInfo",{displayName:l,photoURL:d});else{var e=new Date;l=i.displayName,d=i.photoURL,n("setUserInfo",{displayName:l,photoURL:d}),c.set({createdAt:e,displayName:l,photoURL:d,email:s})}a.realtimeDatabase.realtimePresence&&n("update_rtdb_presence",{uid:o,displayName:l,email:s,photoURL:d})})}}})},,function(t,e,n){"use strict";var a=n(157),i=n.n(a),r=n(158),s=n.n(r),o=n(162),c=n.n(o),u=n(190),l=n.n(u),d=n(33),f=n.n(d),v=n(14),g=v.e.ref("presence"),h=new v.a(g),p={state:"online",last_changed:v.f.database.ServerValue.TIMESTAMP},m={state:{position:null,realtimePresence:null,listeningRadius:1,listeningUserCount:1},getters:{position:function(t){return t.position},listeningRadius:function(t){return t.listeningRadius},listeningUserCount:function(t){return t.listeningUserCount}},mutations:{update_rtdb_presence:function(t,e){f()(p,e),t.realtimePresence.update(e)},setPosition:function(t,e){t.position=e},setRealtimePresence:function(t,e){t.realtimePresence=e},setListeningUserCount:function(t,e){t.listeningUserCount=e},setListeningDistance:function(t,e){t.listeningRadius=e}},actions:{getListeningRadius:function(t){var e=t.state,n=t.commit,a=e.position,i=function(t){var e=l()(t).sort(),a=void 0!==e[2]?e[2]<1?1:e[2]:0===e.length?16384:e.slice(-1)[0]<1?1:e.slice(-1)[0],i=e.filter(function(t){return t<=a});return n("setListeningUserCount",i.length),n("setListeningDistance",a),console.log("radius: "+a+"km, users: "+i.length),a},r={},o=1;return new c.a(function(t){var n=h.query({center:[a.latitude,a.longitude],radius:o}),c=!1;n.on("key_entered",function(t,n,a){e.realtimePresence.key!==t&&(r[t]=a),c&&(o=i(r))}),n.on("key_exited",function(t,e,n){delete r[t],n<=o&&c&&(o=i(r))}),n.on("ready",function(){if(s()(r).length<3&&o<16384)o<<=1,n.updateCriteria({center:[a.latitude,a.longitude],radius:o});else{c=!0;var e=i(r);t(e)}})})},updateLocation:function(t){var e=t.state,n=e.position,a=new v.c(n.latitude,n.longitude),i=[n.latitude,n.longitude],r=n.accuracy;h.set(e.realtimePresence.key,i),f()(p,{coordinates:a,accuracy:r}),e.realtimePresence.update(p)},rtdb_presence:function(t,e){var n=t.commit,a=t.state,r=e.uid,s=a.position,o=new v.c(s.latitude,s.longitude),c=[s.latitude,s.longitude],u=s.accuracy;f()(p,{coordinates:o,accuracy:u,uid:r});var l=g.push();n("setRealtimePresence",l),v.e.ref(".info/connected").on("value",function(t){if(t.val())l.onDisconnect().remove().then(h.set(l.key,c)).then(l.update(p));else{var e=i()({},p,{state:"offline"});l.update(e)}})}}};e.a=m},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e){},,,,,,,,function(t,e){},,function(t,e){},,,,,function(t,e){},,function(t,e){},,,function(t,e){},,,,function(t,e){},function(t,e){},,,,function(t,e){},,,function(t,e){},,,,,,,,function(t,e){},,function(t,e){},,,function(t,e){},,,,,function(t,e){},,,,,function(t,e){},,,,,function(t,e){},,function(t,e){},function(t,e){},,,function(t,e){},,function(t,e){},,,function(t,e){},,,,function(t,e){},,,,,,function(t,e){},,,,,,,function(t,e){},,,,,,,function(t,e){},function(t,e){},,,,,,,,,,function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n(91),i=n(315),r=n(7),s=r(a.a,i.a,!1,null,null,null);e.default=s.exports},,function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{ref:"flyaway"},[t._t("default")],2)])},i=[],r={render:a,staticRenderFns:i};e.a=r},function(t,e,n){"use strict";function a(t){n(317)}Object.defineProperty(e,"__esModule",{value:!0});var i=n(92),r=n(319),s=n(7),o=a,c=s(i.a,r.a,!1,o,null,null);e.default=c.exports},function(t,e){},,function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"vue-map-container"},[n("div",{ref:"vue-map",staticClass:"vue-map"}),t._v(" "),n("div",{staticClass:"vue-map-hidden"},[t._t("default")],2),t._v(" "),t._t("visible")],2)},i=[],r={render:a,staticRenderFns:i};e.a=r},function(t,e,n){"use strict";function a(t){n(321)}Object.defineProperty(e,"__esModule",{value:!0});var i=n(94),r=n(323),s=n(7),o=a,c=s(i.a,r.a,!1,o,null,null);e.default=c.exports},function(t,e){},,function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"vue-street-view-pano-container"},[n("div",{ref:"vue-street-view-pano",staticClass:"vue-street-view-pano"}),t._v(" "),t._t("default")],2)},i=[],r={render:a,staticRenderFns:i};e.a=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n(95),i=n.n(a);for(var r in a)"default"!==r&&function(t){n.d(e,t,function(){return a[t]})}(r);var s=n(325),o=n(7),c=o(i.a,s.a,!1,null,null,null);e.default=c.exports},function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("label",[n("span",{domProps:{textContent:t._s(t.label)}}),t._v(" "),n("input",{ref:"input",class:t.className,attrs:{type:"text",placeholder:t.placeholder}})])},i=[],r={render:a,staticRenderFns:i};e.a=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n(97),i=n(328),r=n(7),s=r(a.a,i.a,!1,null,null,null);e.default=s.exports},,function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement;return(t._self._c||e)("input",{ref:"input",attrs:{type:"text",placeholder:t.placeholder},domProps:{value:t.value}})},i=[],r={render:a,staticRenderFns:i};e.a=r}],[98]);
//# sourceMappingURL=app.f86ff71b3060cac8d03f.js.map